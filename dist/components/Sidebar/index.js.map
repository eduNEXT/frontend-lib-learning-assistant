{"version":3,"file":"index.js","names":["_react","_interopRequireWildcard","require","_reactRedux","_propTypes","_interopRequireDefault","_paragon","_icons","_surveyMonkey","_APIError","_ChatBox","_Disclosure","_MessageForm","_UpgradePanel","_hooks","_xpertLogo","_jsxRuntime","e","__esModule","default","_getRequireWildcardCache","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","Sidebar","_ref","courseId","isOpen","setIsOpen","unitId","apiError","disclosureAcknowledged","messageList","useSelector","state","learningAssistant","upgradeable","upgradeUrl","auditTrialExpired","auditTrialDaysRemaining","useCourseUpgrade","track","useTrackEvent","chatboxContainerRef","useRef","useEffect","messageContainer","current","scrollHeight","clientHeight","maxScrollTop","duration","startTime","Date","now","endTime","scroll","currentTime","timeFraction","scrollTop","scrollTo","top","behavior","requestAnimationFrame","handleClick","length","showSurvey","getMessageForm","jsx","shouldAutofocus","handleUpgradeLinkClick","getUpgradeLink","onClick","target","href","rel","children","getDaysRemainingMessage","intlRelativeTime","Intl","RelativeTimeFormat","style","jsxs","format","getSidebar","className","ReactComponent","getPanel","showUpgrade","IconButton","src","Close","iconAs","Icon","alt","variant","invertColors","propTypes","PropTypes","string","isRequired","bool","func","_default","exports"],"sources":["../../../src/components/Sidebar/index.jsx"],"sourcesContent":["import React, { useRef, useEffect } from 'react';\nimport { useSelector } from 'react-redux';\nimport PropTypes from 'prop-types';\n\nimport {\n  Icon,\n  IconButton,\n} from '@openedx/paragon';\nimport { Close } from '@openedx/paragon/icons';\n\nimport showSurvey from '../../utils/surveyMonkey';\n\nimport APIError from '../APIError';\nimport ChatBox from '../ChatBox';\nimport Disclosure from '../Disclosure';\nimport MessageForm from '../MessageForm';\nimport UpgradePanel from '../UpgradePanel';\nimport { useCourseUpgrade, useTrackEvent } from '../../hooks';\nimport { ReactComponent as XpertLogo } from '../../assets/xpert-logo.svg';\nimport './Sidebar.scss';\n\nconst Sidebar = ({\n  courseId,\n  isOpen,\n  setIsOpen,\n  unitId,\n}) => {\n  const {\n    apiError,\n    disclosureAcknowledged,\n    messageList,\n  } = useSelector(state => state.learningAssistant);\n\n  const {\n    upgradeable, upgradeUrl, auditTrialExpired, auditTrialDaysRemaining,\n  } = useCourseUpgrade();\n\n  const { track } = useTrackEvent();\n\n  const chatboxContainerRef = useRef(null);\n\n  // this use effect is intended to scroll to the bottom of the chat window, in the case\n  // that a message is larger than the chat window height.\n  useEffect(() => {\n    const messageContainer = chatboxContainerRef.current;\n\n    if (messageContainer) {\n      const { scrollHeight, clientHeight } = messageContainer;\n      const maxScrollTop = scrollHeight - clientHeight;\n      const duration = 200;\n\n      if (maxScrollTop > 0) {\n        const startTime = Date.now();\n        const endTime = startTime + duration;\n\n        const scroll = () => {\n          const currentTime = Date.now();\n          const timeFraction = (currentTime - startTime) / duration;\n          const scrollTop = maxScrollTop * timeFraction;\n\n          messageContainer.scrollTo({\n            top: scrollTop,\n            behavior: 'smooth',\n          });\n\n          if (currentTime < endTime) {\n            requestAnimationFrame(scroll);\n          }\n        };\n\n        requestAnimationFrame(scroll);\n      }\n    }\n  }, [messageList, isOpen, apiError]);\n\n  const handleClick = () => {\n    setIsOpen(false);\n\n    if (messageList.length >= 2) {\n      showSurvey();\n    }\n  };\n\n  const getMessageForm = () => (\n    <MessageForm courseId={courseId} shouldAutofocus unitId={unitId} />\n  );\n\n  const handleUpgradeLinkClick = () => {\n    track('edx.ui.lms.learning_assistant.days_remaining_banner_upgrade_click');\n  };\n\n  const getUpgradeLink = () => (\n    <a\n      onClick={handleUpgradeLinkClick}\n      target=\"_blank\"\n      href={upgradeUrl}\n      rel=\"noreferrer\"\n      data-testid=\"days_remaining_banner_upgrade_link\"\n    >\n      Upgrade\n    </a>\n  );\n\n  const getDaysRemainingMessage = () => { // eslint-disable-line consistent-return\n    if (auditTrialDaysRemaining > 1) {\n      const intlRelativeTime = new Intl.RelativeTimeFormat({ style: 'long' });\n      return (\n        <div data-testid=\"days-remaining-message\">\n          Your trial ends {intlRelativeTime.format(auditTrialDaysRemaining, 'day')}. {getUpgradeLink()} for full access to Xpert.\n        </div>\n      );\n    } if (auditTrialDaysRemaining === 1) {\n      return (\n        <div data-testid=\"trial-ends-today-message\">\n          Your trial ends today! {getUpgradeLink()} for full access to Xpert.\n        </div>\n      );\n    }\n  };\n\n  const getSidebar = () => (\n    <div\n      className=\"h-100 d-flex flex-column justify-content-stretch\"\n      data-testid=\"sidebar-xpert\"\n    >\n      <div className=\"p-3 sidebar-header\" data-testid=\"sidebar-xpert-header\">\n        <XpertLogo />\n      </div>\n      {upgradeable\n        && (\n          <div className=\"p-3 trial-header\" data-testid=\"get-days-remaining-message\">\n            {getDaysRemainingMessage()}\n          </div>\n        )}\n      <span className=\"separator\" />\n      <ChatBox\n        chatboxContainerRef={chatboxContainerRef}\n        messageList={messageList}\n      />\n      {\n        apiError\n        && (\n          <div className=\"d-flex flex-column p-3 mt-auto\">\n            <APIError />\n          </div>\n        )\n      }\n      {getMessageForm()}\n    </div>\n  );\n\n  const getPanel = () => {\n    const showUpgrade = upgradeable && auditTrialExpired;\n\n    if (showUpgrade) {\n      return <UpgradePanel />;\n    }\n    return (disclosureAcknowledged ? (getSidebar()) : (<Disclosure>{getMessageForm()}</Disclosure>));\n  };\n\n  return (\n    isOpen && (\n      <div\n        className=\"sidebar position-fixed\"\n        data-testid=\"sidebar\"\n      >\n        <IconButton\n          className=\"chat-close position-absolute m-2 border-0\"\n          src={Close}\n          iconAs={Icon}\n          onClick={handleClick}\n          alt=\"close\"\n          aria-label=\"close\"\n          variant=\"primary\"\n          invertColors\n          data-testid=\"close-button\"\n        />\n        {getPanel()}\n      </div>\n    )\n  );\n};\n\nSidebar.propTypes = {\n  courseId: PropTypes.string.isRequired,\n  isOpen: PropTypes.bool.isRequired,\n  setIsOpen: PropTypes.func.isRequired,\n  unitId: PropTypes.string.isRequired,\n};\n\nexport default Sidebar;\n"],"mappings":"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","ignoreList":[]}