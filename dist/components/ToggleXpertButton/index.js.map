{"version":3,"file":"index.js","names":["_propTypes","_interopRequireDefault","require","_react","_interopRequireWildcard","_analytics","_auth","_paragon","_icons","_optimizely","_xpertLogo","_experiments","_jsxRuntime","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","ownKeys","keys","getOwnPropertySymbols","o","filter","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","value","configurable","writable","_toPrimitive","Symbol","toPrimitive","TypeError","String","Number","ToggleXpert","_ref","isOpen","setIsOpen","courseId","contentToolsEnabled","hasDismissedCTA","setHasDismissedCTA","useState","isModalOpen","setIsModalOpen","target","setTarget","userId","getAuthenticatedUser","decision","usePromptExperimentDecision","enabled","variationKey","experimentPayload","experiment_name","OPTIMIZELY_PROMPT_EXPERIMENT_KEY","variation_key","handleClick","event","sendTrackEvent","course_id","user_id","source","id","localStorage","setItem","handleDismiss","preventDefault","stopPropagation","handleModalClose","shouldDisplayCTA","getItem","chatMargin","jsxs","className","concat","children","jsx","ModalPopup","hasArrow","placement","positionRef","onClose","style","textAlign","gap","ModalCloseButton","variant","Button","onClick","IconButton","src","Close","iconAs","Icon","alt","size","type","ref","ReactComponent","propTypes","PropTypes","bool","isRequired","func","string","_default","exports"],"sources":["../../../src/components/ToggleXpertButton/index.jsx"],"sourcesContent":["import PropTypes from 'prop-types';\nimport React, { useState } from 'react';\nimport { sendTrackEvent } from '@edx/frontend-platform/analytics';\nimport { getAuthenticatedUser } from '@edx/frontend-platform/auth';\nimport {\n  Button,\n  Icon,\n  IconButton,\n  ModalCloseButton,\n  ModalPopup,\n} from '@openedx/paragon';\nimport { Close } from '@openedx/paragon/icons';\n\nimport { OPTIMIZELY_PROMPT_EXPERIMENT_KEY } from '../../data/optimizely';\nimport { ReactComponent as XpertLogo } from '../../assets/xpert-logo.svg';\nimport './index.scss';\nimport { usePromptExperimentDecision } from '../../experiments';\n\nconst ToggleXpert = ({\n  isOpen,\n  setIsOpen,\n  courseId,\n  contentToolsEnabled,\n}) => {\n  const [hasDismissedCTA, setHasDismissedCTA] = useState(false);\n  const [isModalOpen, setIsModalOpen] = useState(true);\n  const [target, setTarget] = useState(null);\n  const { userId } = getAuthenticatedUser();\n\n  const [decision] = usePromptExperimentDecision();\n  const { enabled, variationKey } = decision || {};\n  const experimentPayload = enabled ? {\n    experiment_name: OPTIMIZELY_PROMPT_EXPERIMENT_KEY,\n    variation_key: variationKey,\n  } : {};\n\n  const handleClick = (event) => {\n    // log event if the tool is opened\n    if (!isOpen) {\n      sendTrackEvent(\n        'edx.ui.lms.learning_assistant.launch',\n        {\n          course_id: courseId,\n          user_id: userId,\n          source: event.target.id === 'toggle-button' ? 'toggle' : 'cta',\n          ...experimentPayload,\n        },\n      );\n    }\n    setIsModalOpen(false);\n    localStorage.setItem('completedLearningAssistantTour', 'true');\n    setIsOpen(!isOpen);\n  };\n\n  const handleDismiss = (event) => {\n    // prevent default and propagation to prevent sidebar from opening\n    event.preventDefault();\n    event.stopPropagation();\n    setHasDismissedCTA(true);\n    localStorage.setItem('dismissedLearningAssistantCallToAction', 'true');\n    sendTrackEvent('edx.ui.lms.learning_assistant.dismiss_action_message', {\n      course_id: courseId,\n      ...experimentPayload,\n    });\n  };\n\n  const handleModalClose = () => {\n    localStorage.setItem('completedLearningAssistantTour', 'true');\n    setIsModalOpen(false);\n    sendTrackEvent(\n      'edx.ui.lms.learning_assistant.launch',\n      {\n        course_id: courseId,\n        user_id: userId,\n        source: 'product-tour',\n        ...experimentPayload,\n      },\n    );\n  };\n\n  const shouldDisplayCTA = (\n    (!localStorage.getItem('dismissedLearningAssistantCallToAction') && !hasDismissedCTA)\n    && (localStorage.getItem('completedLearningAssistantTour') || !isModalOpen)\n  );\n\n  const chatMargin = contentToolsEnabled ? 'mb-5' : 'mb-3';\n\n  return (\n    (!isOpen && (\n      <div\n        className={\n          `toggle position-fixed closed d-flex flex-column justify-content-end align-items-end mx-3 border-0\n           ${chatMargin}`\n        }\n        data-testid=\"xpert-toggle\"\n      >\n        <div\n          className=\"position-fixed learning-assistant-popup-modal mb-7\"\n        >\n          <ModalPopup\n            hasArrow\n            placement=\"left\"\n            positionRef={target}\n            isOpen={isModalOpen && !localStorage.getItem('completedLearningAssistantTour')}\n            onClose={handleModalClose}\n          >\n            <div\n              className={`bg-white p-3 rounded shadow border ${chatMargin}`}\n              style={{ textAlign: 'start' }}\n            >\n              <p data-testid=\"modal-message\">\n                Xpert is a new part of your learning experience.<br />\n                You can ask questions and get tutoring help during your course.\n              </p>\n              <div className=\"d-flex justify-content-start\" style={{ gap: '10px' }}>\n                <ModalCloseButton variant=\"outline-primary\" data-testid=\"close-button\">Close</ModalCloseButton>\n                <Button\n                  variant=\"primary\"\n                  className=\"mie-2\"\n                  onClick={handleClick}\n                  data-testid=\"check-button\"\n                >\n                  Check it out\n                </Button>\n              </div>\n            </div>\n          </ModalPopup>\n        </div>\n        { shouldDisplayCTA && (\n          <div\n            className=\"d-flex justify-content-end flex-row \"\n            data-testid=\"action-message\"\n          >\n            <IconButton\n              src={Close}\n              iconAs={Icon}\n              alt=\"dismiss\"\n              onClick={handleDismiss}\n              variant=\"light\"\n              className=\"dismiss-button mx-2 mt-1 bg-gray\"\n              size=\"sm\"\n              data-testid=\"dismiss-button\"\n            />\n            <button\n              className=\"action-message open-negative-margin p-3 mb-4.5\"\n              data-testid=\"message-button\"\n              onClick={handleClick}\n              aria-label=\"Can I answer any questions for you?\"\n              type=\"button\"\n              id=\"cta-button\"\n            >\n              <span>\n                Hi there! ðŸ‘‹ I&apos;m Xpert,\n                an AI-powered assistant from edX who can help you with questions about this course.\n              </span>\n            </button>\n          </div>\n        )}\n        <Button\n          variant=\"primary\"\n          className=\"toggle button-icon\"\n          data-testid=\"toggle-button\"\n          onClick={handleClick}\n          id=\"toggle-button\"\n          ref={setTarget}\n        >\n          <XpertLogo />\n        </Button>\n      </div>\n    ))\n  );\n};\n\nToggleXpert.propTypes = {\n  isOpen: PropTypes.bool.isRequired,\n  setIsOpen: PropTypes.func.isRequired,\n  courseId: PropTypes.string.isRequired,\n  contentToolsEnabled: PropTypes.bool.isRequired,\n};\n\nexport default ToggleXpert;\n"],"mappings":"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","ignoreList":[]}